<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <title>俄語發音</title>

    <style>
        .main {
            grid-area: 1 / 1 / 3 / 4;
            font-family: sans-serif;
            font-size: 50vmin;
        }
        
        .foot {
            grid-area: 3 / 2 / 4 / 3;
            opacity: 0.3;
        }
        
        .esz1 {
            grid-area: 4 / 2 / 5 / 3;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: auto auto auto;
            grid-template-rows: auto auto auto auto;
        }
        
        .grid-container>div {
            text-align: center;
        }
    </style>

</head>

<body>
    <div class="grid-container">
        <div id="letter" class="main"></div>
        <div class="foot">
            <!-- <audio
            id="sound"
            controls
            loop>
            </audio> -->
            <img id="sound" src="play.png">
        </div>
        <div class="esz1">
            <img id="cme" src="cme.png">
        </div>
    </div>

    <script crossorigin="anonymous">
        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return (Math.floor(Math.random() * (max - min + 1)) + min);
        }

        var letters = [
            "Аа",
            "Бб",
            "Вв",
            "Гг",
            "Дд",
            "Ее",
            "Ёё",
            "Жж",
            "Зз",
            "Ии",
            "Йй",
            "Кк",
            "Лл",
            "Мм",
            "Нн",
            "Оо",
            "Пп",
            "Рр",
            "Сс",
            "Тт",
            "Уу",
            "Фф",
            "Хх",
            "Цц",
            "Чч",
            "Шш",
            "Щщ",
            "ъъ",
            "Ыы",
            "ьь",
            "Ээ",
            "Юю",
            "Яя"
        ];

        var sounds = [
            "a.mp3",
            "b.mp3",
            "v.mp3",
            "g.mp3",
            "d.mp3",
            "ye.mp3",
            "yo.mp3",
            "zh.mp3",
            "z.mp3",
            "i.mp3",
            "y.mp3",
            "k.mp3",
            "l.mp3",
            "m.mp3",
            "n.mp3",
            "o.mp3",
            "p.mp3",
            "r.mp3",
            "s.mp3",
            "t.mp3",
            "oo.mp3",
            "f.mp3",
            "kh.mp3",
            "ts.mp3",
            "ch.mp3",
            "sh.mp3",
            "sshch.mp3",
            "no_sound.mp3",
            "iy.mp3",
            "no_sound.mp3",
            "e.mp3",
            "you.mp3",
            "ya.mp3"
        ];

        var idx = getRandomIntInclusive(0, 32);
        var letter = document.getElementById("letter");
        var sound = document.getElementById("sound");
        var cme = document.getElementById("cme");

        var audio = new Audio(sounds[idx]);

        letter.innerHTML = letters[idx];
        // sound.src = sounds[idx];
        audio.loop = true;

        letter.addEventListener("click", event => {
            event.preventDefault;

            idx = getRandomIntInclusive(0, 32);
            letter.innerHTML = letters[idx];
            // sound.src = sounds[idx];
            if (sound.getAttribute('src') == "pause.png") {
                sound.src = "play.png";
            }
            if (!audio.paused) {
                audio.pause();
            }
        });

        sound.addEventListener("click", event => {
            event.preventDefault;
            // console.log(audio.src);
            if (audio.paused) {
                // letter.innerHTML = letters[idx];
                // sound.src = sounds[idx];
                sound.src = "pause.png";
                if (audio.getAttribute('src') != sounds[idx]) {
                    audio.src = sounds[idx];
                    // audio.load();
                }
                audio.play();
            } else {
                sound.src = "play.png";
                audio.pause();
            }
        });

        cme.addEventListener("click", event => {
            event.preventDefault;
            fetch("https://finance.yahoo.com/quote/ES=F")
                .then(response => response.text())
                .then(text => {
                    // console.log(text.length);
                    // console.log(text);
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, "text/html");
                    let el = doc.querySelectorAll("#quote-header-info");
                    // console.log(el.length);
                    let chg = parseFloat(el[0].innerText.split("(")[2].split("%")[0]);
                    // chg = 0.0;
                    let msg = new SpeechSynthesisUtterance();
                    msg.text = (chg > 0 ? "漲" : (chg < 0 ? "跌" : "平")) + Math.abs(chg) + "趴";
                    window.speechSynthesis.speak(msg);
                });
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js').then(function(registration) {
                    console.log('Registered!');
                }, function(err) {
                    console.log('Registration failed: ', err);
                });
            });
        }
    </script>

</body>

</html>